<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>DroidLink Installer</title>

    <style>
      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, #111 0%, #000 60%);
        color: #e0e0e0;
        font-family: monospace;

        display: flex;
        align-items: center;
        justify-content: center;
      }

      h1 {
        margin-bottom: 30px;
        font-size: 1.5rem;
        text-align: center;
        color: #e6e6e6;
      }

      .installer {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .card {
        border: 1px solid #2a2a2a;
        padding: 24px;
        border-radius: 14px;
        width: 360px;
        background: linear-gradient(180deg, #141414, #0e0e0e);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6),
          inset 0 1px 0 rgba(255, 255, 255, 0.03);
      }

      .card p {
        margin-top: 0;
        margin-bottom: 12px;
        color: #aaa;
      }

      .firmware-select button {
        width: 100%;
        margin-bottom: 10px;
        padding: 12px;
        background: #181818;
        color: #ddd;
        border: 1px solid #2c2c2c;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.15s ease;
      }

      .firmware-select button:hover {
        border-color: #4da3ff;
      }

      .firmware-select button.active {
        background: #111c2a;
        border-color: #4da3ff;
        color: #4da3ff;
      }

      input {
        width: 100%;
        background: #1a1a1a;
        color: #e0e0e0;
        border: 1px solid #333;
        padding: 6px;
        border-radius: 4px;
      }

      .install-btn button {
        width: 100%;
        padding: 12px;
        background: #4da3ff;
        color: #000;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }


      @media (max-width: 480px) {
        .card {
          width: 90%;
        }
      }
    </style>

    <script
      type="module"
      src="https://unpkg.com/esp-web-tools@latest/dist/web/install-button.js"
    ></script>
  </head>

  <body>
    <div class="installer">
      <h1>DroidLink Installer</h1>

      <div class="card">
        <p>Select Firmware</p>

        <div class="firmware-select">
          <button onclick="selectFirmware('MASTER')" id="btn-master">
            Master Controller
          </button>
          <button onclick="selectFirmware('SLAVE')" id="btn-slave">
            Universal Slave
          </button>
          <button onclick="selectFirmware('DISPLAY')" id="btn-display">
            Display UI
          </button>
        </div>

        <br />

        <label>
          License Key:
          <input id="license" />
        </label>

        <br /><br />

        <esp-web-install-button id="install" class="install-btn">
          <button slot="activate">Install Firmware</button>
        </esp-web-install-button>
      </div>
    </div>

    <script>
      const button = document.getElementById("install");
      let selectedFirmware = null;

      function selectFirmware(type) {
        selectedFirmware = type;

        ["master", "slave", "display"].forEach((id) => {
          document.getElementById("btn-" + id).classList.remove("active");
        });

        document
          .getElementById("btn-" + type.toLowerCase())
          .classList.add("active");
      }

      button.addEventListener("click", () => {
        const license = document.getElementById("license").value.trim();
        if (!license) {
          alert("License key required");
          return;
        }

        if (!selectedFirmware) {
          alert("Select firmware type");
          return;
        }

        const originalFetch = window.fetch;
        window.fetch = (url, options = {}) => {
          options.headers = {
            ...(options.headers || {}),
            "x-license-key": license,
          };
          return originalFetch(url, options);
        };

        button.manifest = `https://droidlink.github.io/DroidLink_Installer/manifest_${selectedFirmware.toLowerCase()}.json`;
      });
    </script>
  </body>
</html>
