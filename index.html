<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DroidLink Installer</title>
</head>
<body>

<h2>DroidLink Firmware Installer</h2>

<label>
  License Key:
  <input id="license" placeholder="XXXX-XXXX" />
</label>

<br><br>

<button id="install">Install Universal Slave</button>

<script type="module">
  import { install } from "https://unpkg.com/esp-web-tools@9/dist/web/install.js";

  document.getElementById("install").onclick = async () => {
    const license = document.getElementById("license").value.trim();
    if (!license) {
      alert("License key required");
      return;
    }

    await install({
      manifest: "https://droidlink.github.io/DroidLink_Installer/manifest.json",
      beforeInstall: async () => {
        // Inject license header for all fetches
        const originalFetch = window.fetch;
        window.fetch = (url, options = {}) => {
          options.headers = {
            ...(options.headers || {}),
            "x-license-key": license
          };
          return originalFetch(url, options);
        };
      }
    });
  };
</script>

</body>
</html>
